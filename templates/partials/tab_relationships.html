<!-- ðŸ”¼ Ä°liÅŸki Ekle Butonu -->
<div class="d-flex justify-content-end mb-3">
<button class="btn text-white fw-bold btn-sm px-3 py-1 rounded shadow-sm"
        style="background-color: #e1b45f;"
        onclick="resetRelationshipModal(); new bootstrap.Modal(document.getElementById('addRelationshipModal')).show();">
  <i class="bi bi-plus-circle me-2"></i>Ä°liÅŸki Kur
</button>
</div>

{% if relationships %}
  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="text-white" style="background-color: #6c757d;">
            <tr>
              <th class="ps-4">Ad Soyad</th>
              <th>T.C. Kimlik No</th>
              <th>Ä°liÅŸki TÃ¼rÃ¼</th>
              <th>Telefon</th>
              <th>Tarih</th>
              <th class="text-center">Sil</th>
              <th class="text-center pe-4">Git</th>
            </tr>
          </thead>
          <tbody>
            {% for r in relationships %}
              {% if r.from_customer == customer %}
                {% with person=r.to_customer relation=r.relationship_type.name %}
                  <tr class="border-bottom" id="relationship-row-{{ r.id }}">
                    <td class="ps-4 fw-medium">{{ person.full_name }}</td>
                    <td>{{ person.identity_number|slice:":3" }}***{{ person.identity_number|slice:"-2:" }}</td>
                    <td>{{ relation }}</td>
                    <td>{{ person.phone_number|slice:":3" }}***{{ person.phone_number|slice:"-2:" }}</td>
                    <td class="text-muted">{{ r.created_at|date:"d.m.Y H:i" }}</td>
                    <td class="text-center">
                      <a href="#" class="text-danger" title="Ä°liÅŸkiyi Sil" onclick="deleteRelationship({{ r.id }}); return false;">
                        <i class="bi bi-trash3 fs-5"></i>
                      </a>
                    </td>
                    <td class="text-center pe-4">
                      <a href="/database/customer/?key={{ person.customer_key }}" class="text-decoration-none text-primary">
                        <i class="bi bi-box-arrow-up-right fs-5"></i>
                      </a>
                    </td>
                  </tr>
                {% endwith %}
              {% elif r.to_customer == customer %}
                {% with person=r.from_customer relation=r.relationship_type.reverse_name %}
                  <tr class="border-bottom" id="relationship-row-{{ r.id }}">
                    <td class="ps-4 fw-medium">{{ person.full_name }}</td>
                    <td>{{ person.identity_number|slice:":3" }}***{{ person.identity_number|slice:"-2:" }}</td>
                    <td>{{ relation }}</td>
                    <td>{{ person.phone_number|slice:":3" }}***{{ person.phone_number|slice:"-2:" }}</td>
                    <td class="text-muted">{{ r.created_at|date:"d.m.Y H:i" }}</td>
                    <td class="text-center">
                      <a href="#" class="text-danger" title="Ä°liÅŸkiyi Sil" onclick="deleteRelationship({{ r.id }}); return false;">
                        <i class="bi bi-trash3 fs-5"></i>
                      </a>
                    </td>
                    <td class="text-center pe-4">
                      <a href="/database/customer/?key={{ person.customer_key }}" class="text-decoration-none text-primary">
                        <i class="bi bi-box-arrow-up-right fs-5"></i>
                      </a>
                    </td>
                  </tr>
                {% endwith %}
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {% if page_obj and page_obj.paginator.num_pages > 1 %}
    <div class="d-flex justify-content-center py-3">
      <ul class="pagination pagination-sm mb-0">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="#" onclick="loadRelationshipPage({{ page_obj.previous_page_number }})">Â«</a>
          </li>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
          <li class="page-item {% if page_obj.number == num %}active{% endif %}">
            <a class="page-link" href="#" onclick="loadRelationshipPage({{ num }})">{{ num }}</a>
          </li>
        {% endfor %}
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="#" onclick="loadRelationshipPage({{ page_obj.next_page_number }})">Â»</a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% endif %}
{% else %}
  <div class="text-center text-muted my-4">
    <i class="bi bi-person-x fs-1 mb-3" style="color: #adb5bd;"></i>
    <div>Bu mÃ¼ÅŸteriyle iliÅŸkilendirilmiÅŸ kiÅŸi bulunmamaktadÄ±r.</div>
  </div>
{% endif %}

<!-- ðŸ”½ Ä°liÅŸki Kur Modal -->
<div class="modal fade" id="addRelationshipModal" tabindex="-1" aria-labelledby="relationshipModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal BaÅŸlÄ±k -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Ä°liÅŸki Kur</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <!-- Modal Ä°Ã§eriÄŸi + Form -->
      <form id="addRelationshipForm" onsubmit="return handleRelationshipSubmit(event)">
        <div class="modal-body">

          <!-- Kimlik GiriÅŸi ve Ara -->
          <div class="input-group mb-3">
            <input type="text" id="add_identity_input" class="form-control" maxlength="11"
              inputmode="numeric" pattern="[0-9]{10,11}" placeholder="T.C. Kimlik No" required>
            <button class="btn text-white fw-bold" style="background-color:#e1b45f;" type="button"
              onclick="searchRelationshipPerson()">Ara</button>
          </div>

          <!-- DoÄŸum Tarihi ve Ara -->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-cake2"></i></span>
            <input type="text" id="add_birthdate_input" class="form-control"
              placeholder="DoÄŸum Tarihi (GG.AA.YYYY)">
            <button class="btn text-white fw-bold" style="background-color:#e1b45f;" type="button"
              onclick="fetchFullnameByIdentityAndBirth()">SigortalÄ± Ara</button>
          </div>

          <!-- Ad Soyad -->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-person"></i></span>
            <input type="text" id="add_fullname_input" class="form-control readonly-grey"
              placeholder="Ad Soyad" required>
          </div>
          <!-- Telefon -->
          <div class="input-group mb-3">
            <span class="input-group-text"><i class="bi bi-telephone"></i></span>
            <input type="text" id="add_phone_input" class="form-control" maxlength="10"
              inputmode="numeric" pattern="5[0-9]{9}" placeholder="Telefon (5xx xxx xx xx)">
          </div>
          <!-- Ä°liÅŸki TÃ¼rÃ¼ -->
          <div id="relationship_type_wrapper" class="mb-3 position-relative">
            <label for="relationship_type_select" class="form-label">Ä°liÅŸki TÃ¼rÃ¼</label>
            <select id="relationship_type_select" class="form-select" required>
              <option value="">Ä°liÅŸki TÃ¼rÃ¼ SeÃ§iniz</option>
            </select>
          </div>
          <!-- Hata Kutusu -->
          <div id="relation_error" class="text-danger small mt-2"></div>
        </div>
        <!-- Modal Footer -->
        <div class="modal-footer" id="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Kapat</button>
          <button class="btn btn-primary" id="relationshipSaveBtn" type="submit">
            Ä°liÅŸkilendir ve Kaydet
          </button>
        </div>
      </form>
    </div>
  </div>
</div>






